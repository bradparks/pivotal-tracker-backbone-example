/*global Backbone *//*jshint curly: false, laxcomma: true */var PTrack=PTrack||{};(function(){PTrack.Routers=PTrack.Routers||{};PTrack.Routers.MainRouter=Backbone.Router.extend({routes:{"":"projectsRoute","login/":"loginRoute","logout/":"logoutRoute","projects/":"projectsRoute"},states:[],initialize:function(e){this.dispatcher=e.dispatcher;var t=new PTrack.Views.HeaderView({el:$("header"),dispatcher:e.dispatcher})},removeStates:function(){_.each(this.states,function(e){e.destroy()})},addState:function(e){this.states.push(e)},indexRoute:function(){if(!PTrack.session.isAuthenticated())return Backbone.history.navigate("login/",!0)},loginRoute:function(){this.removeStates();var e;e=new PTrack.Views.LoginView({dispatcher:this.dispatcher});e.render();$("#container").append(e.el);var t=function(e){this.dispatcher.trigger(PTrack.actions.ATTEMPT_LOGIN,e)},n=function(t){e.showError("Login failed")},r=function(e){return Backbone.history.navigate("",!0)},i=function(){e.off("submit",t);this.dispatcher.off(PTrack.actions.LOGIN_FAILED,n);this.dispatcher.off(PTrack.actions.LOGIN_SUCCESS,r);e.off("destroy",i)};e.on("submit",t);this.dispatcher.on(PTrack.actions.LOGIN_FAILED,n);this.dispatcher.on(PTrack.actions.LOGIN_SUCCESS,r);e.on("destroy",i);this.addState(e)},logoutRoute:function(){if(!PTrack.session.isAuthenticated())return Backbone.history.navigate("login/",!0);PTrack.session.remove();this.dispatcher.trigger(PTrack.actions.LOGOUT_SUCCESS);return Backbone.history.navigate("login/",!0)},projectsRoute:function(){if(!PTrack.session.isAuthenticated())return Backbone.history.navigate("login/",!0);this.removeStates();var e,t;e=new PTrack.Collections.Projects;t=new PTrack.Views.ProjectsView({dispatcher:this.dispatcher,collection:e});t.render();$("#container").append(t.el);e.bind("reset",t.render,t);e.fetch();var n=function(){e.unbind("reset",t.render,t)};t.on("destroy",n);this.addState(t)}})})();